{% extends 'voiture/admin/navbar.html' %}

{% block content %}

<!-- ================= Messages flash ================= -->
{% if messages %}
  <div class="fixed top-20 right-5 space-y-2 z-50">
    {% for message in messages %}
      <div id="msg-{{ forloop.counter }}"
           class="px-4 py-2 rounded shadow-lg text-white
                  {% if message.tags == 'success' %}bg-green-500
                  {% elif message.tags == 'error' %}bg-red-500
                  {% else %}bg-blue-500{% endif %}
                  animate-fadeOut">
        {{ message }}
      </div>
    {% endfor %}
  </div>

  <script>
    {% for message in messages %}
      setTimeout(() => {
        const msg = document.getElementById('msg-{{ forloop.counter }}');
        if(msg) msg.remove();
      }, 2000);
    {% endfor %}
  </script>
{% endif %}

<!-- ================= Statistiques ================= -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">

  <!-- Clients -->
  <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-dark rounded-2xl shadow-lg p-4 flex justify-between items-center transform transition hover:-translate-y-1 hover:shadow-2xl">
    <div>
      <h6 class="uppercase text-sm">Clients</h6>
      <p class="text-3xl font-bold text-center">{{ utilisateurs_count }}</p>
    </div>
    <i class="fa fa-users fa-2x"></i>
  </div>

  <!-- Voitures -->
  <div class="bg-gradient-to-r from-green-400 to-green-600 text-dark rounded-2xl shadow-lg p-4 flex justify-between items-center transform transition hover:-translate-y-1 hover:shadow-2xl">
    <div>
      <h6 class="uppercase text-sm">Voitures</h6>
      <p class="text-3xl font-bold text-center">{{ voitures_count }}</p>
    </div>
    <i class="fa fa-car fa-2x"></i>
  </div>

  <!-- Réservations -->
  <div class="bg-gradient-to-r from-yellow-300 to-yellow-500 text-gray-900 rounded-2xl shadow-lg p-4 flex justify-between items-center transform transition hover:-translate-y-1 hover:shadow-2xl">
    <div>
      <h6 class="uppercase text-sm">Réservations</h6>
      <p class="text-3xl font-bold text-center">{{ reservations_count }}</p>
    </div>
    <i class="fa fa-book fa-2x"></i>
  </div>

  <!-- Marques -->
  <div class="bg-gradient-to-r from-teal-400 to-teal-600 text-dark rounded-2xl shadow-lg p-4 flex justify-between items-center transform transition hover:-translate-y-1 hover:shadow-2xl">
    <div>
      <h6 class="uppercase text-sm">Marques</h6>
      <p class="text-3xl font-bold text-center">{{ marques_count }}</p>
    </div>
    <i class="fa fa-tags fa-2x"></i>
  </div>

</div>

<!-- ================= Graphiques ================= -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">

  <!-- État des voitures -->
  <div class="bg-white rounded-2xl shadow-lg p-4">
    <h6 class="font-bold mb-2 text-gray-800">État des voitures</h6>
    <canvas id="voituresChart"></canvas>
  </div>

  <!-- Réservations par jour -->
  <div class="bg-white rounded-2xl shadow-lg p-4">
    <h6 class="font-bold mb-2 text-gray-800">Réservations par jour</h6>
    <canvas id="reservationsChart"></canvas>
  </div>

</div>

<!-- Animation fade out pour messages -->
<style>
@keyframes fadeOut {
  0% { opacity: 1; }
  80% { opacity: 1; }
  100% { opacity: 0; }
}
.animate-fadeOut {
  animation: fadeOut 2s forwards;
}
</style>

{% endblock content %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function(){
    $('#voituresTable').DataTable({
        language: {
            search: "Rechercher:",
            lengthMenu: "Afficher _MENU_ entrées",
            info: "Affichage de _START_ à _END_ sur _TOTAL_ entrées",
            paginate: { first: "Premier", last: "Dernier", next: "Suivant", previous: "Précédent" }
        }
    });

    // Graphique État des voitures
    const ctxVoitures = document.getElementById('voituresChart').getContext('2d');
    new Chart(ctxVoitures, {
        type: 'doughnut',
        data: {
            labels: ['Disponible', 'Réservée', 'Vendue'],
            datasets: [{
                label: 'Voitures',
                data: [20, 15, 10],
                backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
                borderColor: ['#fff','#fff','#fff'],
                borderWidth: 2
            }]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    // Graphique Réservations par jour
    const ctxRes = document.getElementById('reservationsChart').getContext('2d');
    new Chart(ctxRes, {
        type: 'bar',
        data: {
            labels: ['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'],
            datasets: [{
                label: 'Réservations',
                data: [2,4,1,5,3,2,1],
                backgroundColor: '#17a2b8'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
});
</script>
{% endblock extra_js %}
