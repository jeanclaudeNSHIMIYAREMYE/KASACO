{% extends "voiture/admin/navbar.html" %}
{% block content %}

<!-- Background avec flou + overlay -->
<div class="relative">

    <!-- Image -->
    <div class="absolute inset-0 bg-cover bg-center"
         style="background-image: url('/static/img/car-bg.jpg');"></div>

    <!-- Flou + fondu sombre -->
    <div class="absolute inset-0 backdrop-blur-md bg-black/50"></div>

    <!-- Contenu -->
    <div class="relative z-10 p-6">

        <div class="container mx-auto">

            <!-- Titre -->
            <div class="flex items-center mb-6 text-white">
                <i class="fa fa-car text-blue-400 text-3xl mr-3"></i>
                <h2 class="text-3xl font-bold">Gestion des Voitures</h2>
            </div>

            <!-- Messages -->
            <div id="messages-container" class="fixed top-6 right-6 z-50 space-y-3">
                {% if messages %}
                    {% for message in messages %}
                        <div class="bg-green-100/90 border border-green-400 text-green-900
                                    px-4 py-2 rounded-xl shadow-lg flex items-center justify-between
                                    opacity-0 translate-y-3 transition-all duration-500"
                             id="msg{{ forloop.counter }}">
                            <span><i class="fa fa-check-circle mr-2"></i>{{ message }}</span>
                            <button onclick="this.parentElement.remove()" class="font-bold text-green-700">&times;</button>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Bouton Ajouter -->
            <button id="btnAddVoiture"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700
                       mb-4 flex items-center transition transform hover:scale-105">
                <i class="fa fa-plus mr-2"></i> Ajouter une voiture
            </button>

            <!-- Formulaire -->
            <div id="formAddVoiture" class="bg-white/90 backdrop-blur-xl p-6 rounded-2xl shadow-xl mb-6 hidden">
                <h3 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                    <i class="fa fa-car-side mr-2 text-blue-500"></i> Nouveau véhicule
                </h3>

                <form method="POST" action="{% url 'ajouter_voiture' %}" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}

                    <!-- Ligne 1 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="font-medium">Marque *</label>
                            {{ form.marque }}
                        </div>
                        <div>
                            <label class="font-medium">Modèle *</label>
                            {{ form.modele }}
                        </div>
                    </div>

                    <!-- Ligne 2 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label>Numéro Châssis</label>
                            {{ form.numero_chassis }}
                        </div>
                        <div>
                            <label>Numéro Moteur</label>
                            {{ form.numero_moteur }}
                        </div>
                    </div>

                    <!-- Ligne 3 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label>Année</label>
                            {{ form.annee }}
                        </div>
                        <div>
                            <label>Cylindrée (CC)</label>
                            {{ form.cylindree_cc }}
                        </div>
                    </div>

                    <!-- Ligne 4 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label>Transmission</label>
                            {{ form.transmission }}
                        </div>
                        <div>
                            <label>Kilométrage</label>
                            {{ form.kilometrage }}
                        </div>
                    </div>

                    <!-- Ligne 5 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label>Couleur</label>
                            {{ form.couleur }}
                        </div>
                        <div>
                            <label>Prix</label>
                            {{ form.prix }}
                        </div>
                    </div>

                    <!-- Ligne 6 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label>État</label>
                            {{ form.etat }}
                        </div>
                        <div>
                            <label>Photo principale</label>
                            {{ form.photo }}
                        </div>
                    </div>

                    <!-- Multi images -->
                    <div>
                        <label>Autres photos</label>
                        <input type="file" name="images" multiple
                               class="w-full border border-gray-300 rounded-lg p-2 bg-white shadow-sm">
                    </div>

                    <!-- Boutons -->
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="btnCancel"
                                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            <i class="fa fa-times mr-1"></i> Annuler
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fa fa-check mr-1"></i> Publier
                        </button>
                    </div>

                </form>
            </div>

            <!-- Tableau -->
            <div class="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl overflow-x-auto p-4">
                <table class="min-w-full text-center">
                    <thead class="bg-gray-900 text-white">
                        <tr>
                            <th class="px-3 py-2">#</th>
                            <th class="px-3 py-2">Marque</th>
                            <th class="px-3 py-2">Modèle</th>
                            <th class="px-3 py-2">Châssis</th>
                            <th class="px-3 py-2">Moteur</th>
                            <th class="px-3 py-2">Année</th>
                            <th class="px-3 py-2">CC</th>
                            <th class="px-3 py-2">Transmission</th>
                            <th class="px-3 py-2">KM</th>
                            <th class="px-3 py-2">Couleur</th>
                            <th class="px-3 py-2">Prix</th>
                            <th class="px-3 py-2">État</th>
                            <th class="px-3 py-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for voiture in voitures %}
                        <tr class="border-b hover:bg-gray-100 transition">
                            <td class="px-3 py-2">{{ forloop.counter }}</td>
                            <td class="px-3 py-2">{{ voiture.marque.nom }}</td>
                            <td class="px-3 py-2">{{ voiture.modele.nom }}</td>
                            <td class="px-3 py-2">{{ voiture.numero_chassis }}</td>
                            <td class="px-3 py-2">{{ voiture.numero_moteur }}</td>
                            <td class="px-3 py-2">{{ voiture.annee }}</td>
                            <td class="px-3 py-2">{{ voiture.cylindree_cc }}</td>
                            <td class="px-3 py-2">{{ voiture.transmission }}</td>
                            <td class="px-3 py-2">{{ voiture.kilometrage }}</td>
                            <td class="px-3 py-2">{{ voiture.couleur }}</td>
                            <td class="px-3 py-2">{{ voiture.prix }}</td>
                            <td class="px-3 py-2">{{ voiture.etat }}</td>
                            <td class="px-3 py-2">
                                <a href="{% url 'supprimer_voiture' voiture.id %}"
                                   onclick="return confirm('Supprimer ?')"
                                   class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="13" class="py-4 text-gray-600">Aucune voiture trouvée.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="flex justify-center mt-6">
                <nav class="inline-flex items-center space-x-2">

                    {% if voitures.has_previous %}
                        <a href="?page={{ voitures.previous_page_number }}"
                           class="px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black">
                            ← Précédent
                        </a>
                    {% endif %}

                    <span class="px-4 py-2 bg-white/90 rounded-lg shadow">
                        Page {{ voitures.number }} / {{ voitures.paginator.num_pages }}
                    </span>

                    {% if voitures.has_next %}
                        <a href="?page={{ voitures.next_page_number }}"
                           class="px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-black">
                            Suivant →
                        </a>
                    {% endif %}

                </nav>
            </div>

        </div>

    </div>
</div>

<!-- JS animation messages -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('formAddVoiture');
    document.getElementById('btnAddVoiture').onclick = () => form.classList.remove('hidden');
    document.getElementById('btnCancel').onclick = () => form.classList.add('hidden');

    const msgs = document.querySelectorAll('#messages-container div');
    msgs.forEach((m, i) => {
        setTimeout(() => m.classList.remove('opacity-0', 'translate-y-3'), 150 * i);
        setTimeout(() => {
            m.classList.add('opacity-0', 'translate-y-3');
            setTimeout(() => m.remove(), 500);
        }, 2500);
    });
});
</script>

{% endblock content %}
