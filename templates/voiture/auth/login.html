{% extends 'voiture/navigation.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

<!-- Wrapper principal -->
<div class="flex items-center justify-center min-h-screen bg-cover bg-center px-4"
     style="background-image: url('{% static 'images/honda.jpg' %}'); margin-top:70px;">

    <!-- Carte du formulaire -->
    <div class="bg-white shadow-xl rounded-2xl p-4 sm:p-6 max-w-xs sm:max-w-sm bg-opacity-90 w-full">

        <!-- MESSAGES DJANGO -->
        {% if messages %}
            <div id="messages-container" class="space-y-3 mb-4">
                {% for message in messages %}
                    <div class="message-alert px-4 py-3 rounded-lg text-sm font-medium border transition-opacity duration-500
                        {% if message.tags == 'success' %} bg-green-100 text-green-800 border-green-300
                        {% elif message.tags == 'error' %} bg-red-100 text-red-800 border-red-300
                        {% elif message.tags == 'warning' %} bg-yellow-100 text-yellow-800 border-yellow-300
                        {% else %} bg-blue-100 text-blue-800 border-blue-300
                        {% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Titre -->
        <h3 class="text-center text-lg sm:text-xl font-bold mb-4 sm:mb-6 text-gray-800">
            <i class="fa fa-user-circle mr-2 text-red-600"></i> Connexion
        </h3>

        <!-- FORMULAIRE -->
        <form method="POST" novalidate class="space-y-3 sm:space-y-4">
            {% csrf_token %}

            <!-- ERREURS GLOBALES DU FORMULAIRE -->
            {% if form.non_field_errors %}
                <div class="message-alert bg-red-50 border border-red-300 text-red-700 px-3 py-2 rounded-lg text-xs sm:text-sm">
                    <ul class="list-disc list-inside">
                        {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <!-- CHAMPS -->
            {% for field in form %}
                <div class="flex flex-col">
                    <label for="{{ field.id_for_label }}" class="mb-1 font-medium text-gray-700 text-xs sm:text-sm">
                        {% if field.name == "username" %} Email
                        {% elif field.name == "password" %} Mot de passe
                        {% else %} {{ field.label }}
                        {% endif %}
                    </label>

                    {{ field|add_class:"w-full border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition duration-200" }}

                    {% if field.errors %}
                        <p class="text-red-600 text-[10px] sm:text-xs mt-1">
                            {{ field.errors|striptags }}
                        </p>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- BOUTON -->
            <button type="submit"
                class="w-full bg-red-600 text-white py-2 sm:py-2.5 rounded-lg font-semibold text-xs sm:text-sm
                       hover:bg-red-700 transition duration-300 shadow-md hover:shadow-lg flex items-center justify-center">
                <i class="fa fa-sign-in-alt mr-2"></i> Se connecter
            </button>
        </form>

        <!-- LIEN MOT DE PASSE OUBLIE -->
        <div class="text-center mt-2 sm:mt-3 text-xs sm:text-sm">
            <a href="{% url 'verification' %}" class="text-blue-800 font-medium hover:underline">
                Mot de passe oublié ?
            </a>
        </div>

        <!-- LIEN INSCRIPTION -->
        <div class="text-center mt-3 sm:mt-4 text-xs sm:text-sm">
            <p class="text-gray-600">
                Pas encore de compte ?
                <a href="{% url 'signup' %}" class="text-red-600 font-medium hover:underline">
                    Créer un compte
                </a>
            </p>
        </div>

    </div>
</div>

<!-- JS : disparition automatique des messages après 3 secondes -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
            document.querySelectorAll(".message-alert").forEach(function (alert) {
                alert.classList.add("opacity-0");
                setTimeout(() => alert.remove(), 500);
            });
        }, 3000);
    });
</script>

{% endblock %}
